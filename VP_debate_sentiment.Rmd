---
title: "SENTIMENT OF OCT 2016 VP DEBATE SPEECH"
author: "WW44SS"
date: "Oct 6, 2016"
output: 
    html_document:
        css: markdown7.css
        toc: true
        toc_depth: 1
        keep_md: true
---


###SUMMARY
 
This continuation of [BIAS AND CONTEXT IN PRESIDENTIAL DEBATE TEXTS](https://rpubs.com/ww44ss/Debate_Text), which focused on a "Bag of Words" approach to analyzing the text of Presidential Debates. 

This analysis shows a "Heat Map" of frequent words. It is not really a new analysis, but just a better way of visualizing the data.  

###DATA SOURCES AND METHODS
The text of the debate are downloaded from the [UCSB Presidency Project](http://www.presidency.ucsb.edu/debates.php). Transcripts were pasted into Apple Pages and stored as unformatted .txt files.  






```{r, "load local functions", echo=FALSE}

idem <-function(x){x}

## LOAD LOCAL FUNCTIONS
    directory <- "/Users/winstonsaunders/Documents/oct_2016_vp_debate/"
    
```

```{r, "load r libraries", echo=FALSE, warning=FALSE, message=FALSE}

    library(dplyr)
    library(animation)
    library(ggplot2)
    library(tidytext)
```

```{r, "find debate files in directory", echo=FALSE, warning=FALSE, message=FALSE}

    ## 
    ## .txt file detection
    

    directory <- "/Users/winstonsaunders/Documents/oct_2016_vp_debate/"
    file.list <- list.files(directory)
    
    ## search for and read lightly cleaned debate text .csv
    data.file <- file.list[grepl("_cleaned", file.list)]
    
    debate_text <- read.csv(paste0(directory, data.file), stringsAsFactors = FALSE) %>% as_data_frame
  

    ## create tidy df of debate words
    ## add netural non-"stop" word to each
    debate_words <- debate_text %>%
        unnest_tokens(word, paste(text, "people")) %>%
        filter(!word %in% stop_words$word) %>% 
        idem

    ## compute sentiment dictionary
    word_sentiment_dict <- sentiments %>%
        filter(lexicon == "AFINN") %>%
        select(word, sentiment = score) %>%
        idem
    
    ## get sentiment of individual words by joining data with dictionary
    word_sentiment_df <- debate_words %>%
        left_join(word_sentiment_dict, by = "word") %>%
        mutate(sentiment = ifelse(is.na(sentiment), 0, sentiment)) %>%
        idem
    
    ## compute sentiment of debate responses by regrouping and compute means and cumsums
    sentiment_df <- word_sentiment_df %>%
        group_by(X, name) %>%
        summarize(sentiment = sum(sentiment)) %>%
        group_by(name) %>%
        mutate(cumm_sent = cumsum(sentiment)) %>%
        idem
    
    ## create data_frame for plotting. Since some X have no entry, need to fix those
    plot_df <- sentiment_df %>% left_join(debate_text, by = "X") %>%
        #select(X, "name" = name.x, sentiment, cumm_sent, text) %>%
        #mutate(sentiment = ifelse(is.na(sentiment), 0, sentiment)) %>%
        #mutate(cumm_sent_lag = lag(cumm_sent,1)) %>%
        #group_by(name) %>%
       # mutate(cumm_sent = ifelse(is.na(cumm_sent), cumm_sent_lag, cumm_sent)) %>%
       # mutate(cumm_sent = ifelse(is.na(cumm_sent), cumm_sent_lag, cumm_sent)) %>% 
       # mutate(cumm_sent = ifelse(is.na(cumm_sent), cumm_sent_lag, cumm_sent)) %>% 
       # mutate(cumm_sent = ifelse(is.na(cumm_sent), cumm_sent_lag, cumm_sent)) %>%  ## just in case
        #ungroup %>%
        #select(X, name, sentiment, cumm_sent, text) %>%
        idem
    
    
    

    ## go back and add words for strong sentiment
    
    gif_steps <- c(plot_df$X[abs(plot_df$sentiment) > 5 ], plot_df$X[nrow(plot_df)])


    saveGIF({
    for (i in gif_steps) {
        print( 
            ggplot(plot_df %>% filter(X <= i), aes(x = X, y = sentiment, fill = name)) +
                geom_bar(stat = 'identity', alpha = 1.) +
                geom_line(aes(x=X, y = cumm_sent/max(abs(plot_df$cumm_sent), group = name), color = name), size = 1) +
                xlim(range(plot_df$X)) +
                ylim(range(plot_df$sentiment)) +
                ggtitle(paste0(plot_df$name[i], ": ", gsub("[a-z]+$", "", substr(plot_df$text[i], 1, 80)) ) ) +
                facet_grid(name~.) +
                theme_bw()
        ) 
        
          
    }
    }, interval = .5, movie.name = paste0(directory,"sentiment_animation.gif"), ani.width = 800, ani.height = 400)
    
   
```

```{r}

    i <- gif_steps[20]

    ggplot(plot_df , aes(x = X, y = sentiment, fill = name)) + #%>% filter(X <= i), aes(x = X, y = sentiment, fill = name)) +
    geom_bar(stat = 'identity', alpha = 1.) +
    geom_line(aes(x=X, y = cumm_sent/max(abs(plot_df$cumm_sent)), color = name), size = 1) +
    xlim(range(plot_df$X)) +
    ylim(range(plot_df$sentiment)) +
    ggtitle(paste0(plot_df$name[i], ": ", gsub("[a-z]+$", "", substr(plot_df$text[i], 1, 80)) ) ) +
    facet_grid(name~.) +
    theme_bw()

```

