---
title: "SENTIMENT OF OCT 2016 VP DEBATE SPEECH"
author: "WW44SS"
date: "Oct 6, 2016"
output: 
    html_document:
        css: markdown7.css
        toc: true
        toc_depth: 1
        keep_md: true
---


###SUMMARY
 
This continuation of [BIAS AND CONTEXT IN PRESIDENTIAL DEBATE TEXTS](https://rpubs.com/ww44ss/Debate_Text), which focused on a "Bag of Words" approach to analyzing the text of Presidential Debates. 

This analysis shows a "Heat Map" of frequent words. It is not really a new analysis, but just a better way of visualizing the data.  

###DATA SOURCES AND METHODS
The text of the debate are downloaded from the [UCSB Presidency Project](http://www.presidency.ucsb.edu/debates.php). Transcripts were pasted into Apple Pages and stored as unformatted .txt files.  






```{r, "load local functions", echo=FALSE}

idem <-function(x){x}

## LOAD LOCAL FUNCTIONS
    directory <- "/Users/winstonsaunders/Documents/oct_2016_vp_debate/"
    ## load text of debate files
    source(paste0(directory, "load_debate_text.R"))
    ## select candidate text
    source(paste0(directory, "candidate_text.R"))
    ## turn candidate text in a Text Corpus
    source(paste0(directory, "text_tc.R"))
    ## selects candidate text and then turns that into a Text Corpus
    source(paste0(directory, "candidate_text_tc.R"))
    ## enable printing of multiple plots
    source(paste0(directory, "multiplot.R"))
    ## vector normialize
    source(paste0(directory, "vector.normalize.R"))

```

```{r, "load r libraries", echo=FALSE, warning=FALSE, message=FALSE}

     ## check for installed packages
    if(! ("tm" %in% rownames(installed.packages())))      {install.packages("tm")}
    if(! ("RWeka" %in% rownames(installed.packages())))   {install.packages("RWeka")}
    if(! ("SnowballC" %in% rownames(installed.packages()))) {install.packages("SnowballC")}
    if(! ("ggplot2" %in% rownames(installed.packages()))) {install.packages("ggplot2")}
    if(! ("xtable" %in% rownames(installed.packages())))  {install.packages("xtable")}
    if(! ("reshape2" %in% rownames(installed.packages())))  {install.packages("reshape2")}
    if(! ("dplyr" %in% rownames(installed.packages())))  {install.packages("dplyr")}

    library(dplyr)
    library(animation)
    library(tm)
    library(RWeka)
    library(SnowballC)
    library(ggplot2)
    library(xtable)
    library(reshape2)
    library(stringr)
    if(! ("stringr" %in% rownames(installed.packages())))  {install.packages("stringr")}
    if(! ("syuzhet" %in% rownames(installed.packages())))  {install.packages("syuzhet")}
    if(! ("viridis" %in% rownames(installed.packages())))  {install.packages("viridis")}
    library(stringr)
    library(viridis)
    library(syuzhet)
    library(tidytext)
```

```{r, "find debate files in directory", echo=FALSE, warning=FALSE, message=FALSE}

    ## 
    ## .txt file detection
    

    directory <- "/Users/winstonsaunders/Documents/oct_2016_vp_debate/"
    file.list <- list.files(directory)
    
    cleaned.file <- file.list[grepl("_cleaned", file.list)]
    
    debate_all <- read.csv(paste0(directory, cleaned.file), stringsAsFactors = FALSE) %>% as_data_frame
  


    debate_all_s <- debate_all %>% 
        mutate(text_sentiment = get_sentiment(debate_all$text, method = "afinn"))
    
    debate_words  <- debate_all %>%
        select(X, name, text) %>%
        unnest_tokens(word, text) %>%
        filter(!word %in% stop_words$word) %>% 
        #mutate(word_sentiment = get_sentiment(debate_words$word, method = "afinn")) %>%
        idem

    word_sentiment_dict <- sentiments %>%
        filter(lexicon == "AFINN") %>%
        select(word, sentiment = score) %>%
        idem
    
    sentiment_df <- debate_words %>%
        left_join(word_sentiment_dict, by = "word") %>%
        mutate(sent2 = ifelse(is.na(sentiment), 0, sentiment)) %>%
        group_by(X, name) %>%
        summarize(mean_sent = mean(sent2), sum_sent = sum(sent2), abs_sum_sent = sum(abs(sent2))) %>%
        idem

    
    sentiment_plot <- data_frame("X" = as.integer(1), "name" = "junk", "sentiment" = 1., "fit" = 1.)[-1,]
    
    name.x <- unique(sentiment_df$name)[2]    
    
        for (name.x in unique(sentiment_df$name)) {
            fitted_sent <- sentiment_df %>%
                filter(name == name.x) %>%
                idem
                
            l.fit <- loess(mean_sent~ X, fitted_sent, span = .15)
            l.predict <- predict(l.fit, fitted_sent$X)
            
            #plot(l.predict)
            
            fitted_sent <- fitted_sent %>%
                select(X, name, mean_sent) %>%
                bind_cols(as_data_frame(l.predict)) %>%
                idem
            
            colnames(fitted_sent) <- colnames(sentiment_plot)
            
            sentiment_plot <- bind_rows(sentiment_plot, fitted_sent)
        }
            
        sentiment_plot <- sentiment_plot[order(sentiment_plot$X),]

        
    i = 400
    ggplot(sentiment_plot %>% filter(X <= i), aes(x = X, y = sentiment, fill = name)) +
        geom_bar(stat = 'identity', alpha = 1.) + 
        geom_line(aes(x=X, y = 7*fit), color = "blue", size = .4) + 
        facet_grid(name~.) + theme_bw() + 
        xlim(range(sentiment_plot$X)) + 
        ylim(range(sentiment_plot$sentiment)) 
    
    
    
    saveGIF({
    for (i in 1:nrow(sentiment_plot)) {
        print( ggplot(sentiment_plot %>% filter(X <= i), aes(x = X, y = sentiment, fill = name)) +
        geom_bar(stat = 'identity', alpha = 1.) + 
        geom_line(aes(x=X, y = 7*fit), color = "blue", size = .4) + 
        facet_grid(name~.) + theme_bw() + 
        xlim(range(sentiment_plot$X)) + 
        ylim(range(sentiment_plot$sentiment)) ) 
    }
    }, interval = 0.1, movie.name = "sentiment_animation.gif", ani.width = 800, ani.height = 400)

```
