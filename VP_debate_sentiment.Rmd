---
title: "SENTIMENT OF OCT 2016 VP DEBATE SPEECH"
author: "WW44SS"
date: "Oct 6, 2016"
output: 
    html_document:
        css: markdown7.css
        toc: true
        toc_depth: 1
        keep_md: true
---


###SUMMARY
 
This continuation of [BIAS AND CONTEXT IN PRESIDENTIAL DEBATE TEXTS](https://rpubs.com/ww44ss/Debate_Text), which focused on a "Bag of Words" approach to analyzing the text of Presidential Debates. 

This analysis shows a "Heat Map" of frequent words. It is not really a new analysis, but just a better way of visualizing the data.  

###DATA SOURCES AND METHODS
The text of the debate are downloaded from the [UCSB Presidency Project](http://www.presidency.ucsb.edu/debates.php). Transcripts were pasted into Apple Pages and stored as unformatted .txt files.  






```{r, "load local functions", echo=FALSE}

idem <-function(x){x}

## LOAD LOCAL FUNCTIONS
    directory <- "/Users/winstonsaunders/Documents/oct_2016_vp_debate/"
    ## load text of debate files
    source(paste0(directory, "load_debate_text.R"))
    ## select candidate text
    source(paste0(directory, "candidate_text.R"))
    ## turn candidate text in a Text Corpus
    source(paste0(directory, "text_tc.R"))
    ## selects candidate text and then turns that into a Text Corpus
    source(paste0(directory, "candidate_text_tc.R"))
    ## enable printing of multiple plots
    source(paste0(directory, "multiplot.R"))
    ## vector normialize
    source(paste0(directory, "vector.normalize.R"))

```

```{r, "load r libraries", echo=FALSE, warning=FALSE, message=FALSE}

     ## check for installed packages
    if(! ("tm" %in% rownames(installed.packages())))      {install.packages("tm")}
    if(! ("RWeka" %in% rownames(installed.packages())))   {install.packages("RWeka")}
    if(! ("SnowballC" %in% rownames(installed.packages()))) {install.packages("SnowballC")}
    if(! ("ggplot2" %in% rownames(installed.packages()))) {install.packages("ggplot2")}
    if(! ("xtable" %in% rownames(installed.packages())))  {install.packages("xtable")}
    if(! ("reshape2" %in% rownames(installed.packages())))  {install.packages("reshape2")}
    if(! ("dplyr" %in% rownames(installed.packages())))  {install.packages("dplyr")}

    library(dplyr)
    library(animation)
    library(tm)
    library(RWeka)
    library(SnowballC)
    library(ggplot2)
    library(xtable)
    library(reshape2)
    library(stringr)
    if(! ("stringr" %in% rownames(installed.packages())))  {install.packages("stringr")}
    if(! ("syuzhet" %in% rownames(installed.packages())))  {install.packages("syuzhet")}
    if(! ("viridis" %in% rownames(installed.packages())))  {install.packages("viridis")}
    library(stringr)
    library(viridis)
    library(syuzhet)
    library(tidytext)
```

```{r, "find debate files in directory", echo=FALSE, warning=FALSE, message=FALSE}

    ## 
    ## .txt file detection
    

    directory <- "/Users/winstonsaunders/Documents/oct_2016_vp_debate/"
    file.list <- list.files(directory)
    
    cleaned.file <- file.list[grepl("_cleaned", file.list)]
    
    cleaned_debate_text <- read.csv(paste0(directory, cleaned.file), stringsAsFactors = FALSE) %>% as_data_frame
  

    ## create tidy df of debate words
    debate_words <- cleaned_debate_text %>%
        unnest_tokens(word, text) %>%
        filter(!word %in% stop_words$word) %>% 
        idem

    ## compute sentiment dictionary
    word_sentiment_dict <- sentiments %>%
        filter(lexicon == "AFINN") %>%
        select(word, sentiment = score) %>%
        idem
    
    ## get sentiment of individual words by joining data with dictionary
    word_sentiment_df <- debate_words %>%
        left_join(word_sentiment_dict, by = "word") %>%
        mutate(sentiment = ifelse(is.na(sentiment), 0, sentiment)) %>%
        idem
    
    ## compute sentiment of debate responses by regrouping and compute means and cumsums
    sentiment_df <- word_sentiment_df %>%
        group_by(X, name) %>%
        summarize(sentiment = mean(sentiment)) %>%
        group_by(name) %>%
        mutate(cumm_sent = cumsum(sentiment)) %>%
        #ungroup %>%
        idem

    ## go back and add words for strong sentiment
    
    gif_steps <- c(sentiment_df$X[abs(sentiment_df$sentiment) > .6 ], sentiment_df$X[nrow(sentiment_df)])


    saveGIF({
    for (i in gif_steps) {
        print( 
            ggplot(sentiment_df %>% filter(X <= i), aes(x = X, y = sentiment, fill = name)) +
                geom_bar(stat = 'identity', alpha = 1.) + 
                geom_line(aes(x=X, y = 2*cumm_sent/max(abs(cumm_sent)), color = name), size = 1) + 
                facet_grid(name~.) + theme_bw() +
                xlim(range(sentiment_plot$X)) + 
                ylim(range(sentiment_plot$sentiment)) +
                ggtitle(paste0(sentiment_df$name[i], ": ",
                      #paste(word_sentiment_df$word[word_sentiment_df$X == i], sep = "", collapse = " "))
                grep("^([a-z]* )+", substr(cleaned_debate_text$text[i], 1, 40), value=TRUE) ) )
        )  
          
    }
    }, interval = .5, movie.name = paste0(directory,"sentiment_animation.gif"), ani.width = 800, ani.height = 400)
    
    i <- gif_steps[5]
    ggplot(sentiment_df %>% filter(X <= i), aes(x = X, y = sentiment, fill = name)) +
        geom_bar(stat = 'identity', alpha = 1.) + 
        geom_line(aes(x=X, y = 2*cumm_sent/max(abs(cumm_sent)), color = name), size = 1) + 
        facet_grid(name~.) + theme_bw() + 
        xlim(range(sentiment_plot$X)) + 
        ylim(range(sentiment_plot$sentiment)) +
        ggtitle(paste(sentiment_df$name[i], ":",
                      paste(word_sentiment_df$word[word_sentiment_df$X == i], sep = "", collapse = " ")))

```
